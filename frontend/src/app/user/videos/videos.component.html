<div class="videos-container">
  <h1 class="title">Vídeos de ejercicios</h1>
  <p class="subtitle">Encuentra rutinas y ejercicios para cada grupo muscular</p>

  <!-- Sección de Búsqueda -->
  <div class="search-section">
    <div class="search-container">
      <input 
        type="text" 
        [(ngModel)]="searchQuery" 
        placeholder="Buscar ejercicios (ej: pilates, sentadillas...)"
        (keyup.enter)="searchVideos()"
        class="search-input"
      >
      <button 
        mat-raised-button 
        color="primary" 
        (click)="searchVideos()"
        [disabled]="!searchQuery.trim() || loadingSearch"
      >
        <mat-icon>search</mat-icon>
        Buscar
      </button>
    </div>

    <div *ngIf="errorMessage" class="error-message">
      <mat-icon>error_outline</mat-icon>
      {{ errorMessage }}
    </div>

    <!-- Resultados de Búsqueda -->
    <div *ngIf="searchResults.length > 0" class="search-results-container">
      <h3>Resultados de Búsqueda</h3>
      <div class="search-results-grid">
        <div *ngFor="let video of searchResults" class="video-card" (click)="selectVideo(video)">
          <img [src]="getThumbnailUrl(video)" alt="Miniatura del video">
          <div class="video-info">
            <h4>{{ getVideoTitle(video) }}</h4>
            <p>{{ video.snippet.channelTitle }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sección de Playlists por Grupo Muscular -->
  <div class="playlists-section">
    <h3>Vídeos por Grupo Muscular</h3>
    <div class="playlists-grid">
      <div *ngFor="let playlist of playlists" class="playlist-card">
        <h4>{{ playlist.title }}</h4>
        
        <div *ngIf="playlist.loading" class="loading-state">
          <mat-spinner diameter="30"></mat-spinner>
          <span>Cargando vídeos...</span>
        </div>

        <div *ngIf="playlist.error" class="error-state">
          <mat-icon>error_outline</mat-icon>
          <span>Error al cargar</span>
        </div>

        <div *ngIf="!playlist.loading && !playlist.error && playlist.videos.length > 0" class="videos-list">
          <div *ngFor="let video of playlist.videos.slice(0, 3)" class="video-thumbnail" (click)="selectVideo(video)">
            <img [src]="getThumbnailUrl(video)" alt="Miniatura del video">
            <p>{{ getVideoTitle(video) }}</p>
          </div>
          <p class="video-count">{{ playlist.videos.length }} vídeos disponibles</p>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="selectedVideo" class="video-modal">
  <div class="modal-overlay" (click)="selectedVideo = null"></div>
  <div class="modal-content">
    <button mat-icon-button class="close-btn" (click)="selectedVideo = null">
      <mat-icon>close</mat-icon>
    </button>
    
    <!-- Contenedor del iframe con scroll -->
    <div class="video-iframe-container">
      <iframe 
        width="100%" 
        height="500" 
        [src]="getSafeUrl(selectedVideo.id?.videoId || selectedVideo.id)" 
        frameborder="0" 
        allowfullscreen>
      </iframe>
    </div>
    
    <!-- Contenedor de detalles con scroll -->
    <div class="video-details-container">
      <div class="video-details">
        <h2>{{ getVideoTitle(selectedVideo) }}</h2>
        <div class="video-meta">
          <span class="channel">
            <mat-icon>account_circle</mat-icon>
            {{ selectedVideo.snippet.channelTitle || 'Canal desconocido' }}
          </span>
          <span class="date">
            <mat-icon>calendar_today</mat-icon>
            {{ (selectedVideo.snippet.publishedAt | date) || 'Fecha desconocida' }}
          </span>
        </div>
        <div class="description-scroll">
          <p class="description">{{ selectedVideo.snippet.description }}</p>
        </div>
      </div>
    </div>
  </div>
</div>